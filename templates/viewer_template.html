<!DOCTYPE html>

<!-- 
    Keys for parsing template using python:
    @ms_no@ = Current ms no.
    @prev_ms@ = Hyperlink to page for previous milestone
    @next_ms@ - Hyperlink to page for next milestone
    @option_list@ - Place to populate the options for the page
    @ms_text@ - Location for the milestone text
    @top_20_list@ - List of top 20 retrieved texts for the milestone
    @list_of_ms_links@ - List of all the links to the milestone pages
    @data_loc@ location of json file containing the data
    @query_string@ location for adding original query string 'text'
    @input_file_name@ place to add a the input file name to avoid confusion between versions
-->

<html>
    <head>
        <title>Viewer for evaluating outputs</title>

        <!-- Use bootstrap for easy grid layout-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" integrity="sha512-ZnR2wlLbSbr8/c9AgLg3jQPAattCUImNsae6NHYnS9KrIwRdcY9DxFotXhNAKIKbAXlRnujIqUWoXXwqyFOeIQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <!-- CDN of mark.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js"
        integrity=
    "sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww=="
        crossorigin="anonymous"></script>
        
        <style>
            .scrollDiv {
                max-height: 70vh;
                overflow: auto;
                font-size: 1.5em !important;
                color: #000 !important;
                font-family: Amiri !important;
                direction: rtl;
            }

            .bookBox {
                max-height: 20vh;
                overflow: auto;
            }

            mark.markHead {                
                background-color: rgb(172, 114, 6); 
                color: rgb(247, 244, 244);   
            }

            mark.ms {
                background-color: rgb(0, 60, 255);
                color: rgb(247, 244, 244);
                }
            
            mark.pageno {
                background-color: rgb(96, 116, 182);
                }
            
            mark.a0 {
            color: black;
            padding: 5px;
            background: greenyellow;
            }

            .rtl-input {
                direction: rtl
            }
            
        </style>
        
    </head>

    <body>
        
        <!-- Script for taking whats in the dropdown and reading files to populate the right box-->
        <script type="module">
            import data from '@data_loc@' assert { type: 'json' };
            console.log(data);
            let selectText = document.getElementById('pairs-dropdown');
            
            function getData(dataId) {
                return data.filter(
                    function(data){return data.id == dataId}
                )
            };
            
            selectText.onchange = (event) =>{                
                let output = event.target.value;
                let pairedData = getData(output)[0].data;
                document.getElementById('retrieved-text').innerHTML=pairedData;
            }
            

        </script>
        <!-- Script to add highlighting functionality - using mark.js-->
        <script>
            function highlight(param) {
    
                // Select the whole paragraph
                var ob = new Mark(document.querySelector(".select"));
    
                
                // Highlight letter or word
                ob.mark(
                    document.getElementById("searched").value,
                    { className: 'a' + param }
                );
                document.getElementById("searched").value = ""
            };
            function removeHiglight(){
                var ob = new Mark(document.querySelector(".select"));
                // Unmark the highlighted words or letter
                ob.unmark();
            }

        </script>

        <script>


            function openPanel() {                  
                    document.getElementById("ms-panel").setAttribute("class", "col")
                    document.getElementById("panel-1").setAttribute("class", "col")
                    document.getElementById("panel-2").setAttribute("class", "col")
                    document.getElementById("open-button").classList.toggle("d-none")
                    document.getElementById("close-button").classList.toggle("d-none")
            };

            function closePanel(panelId) {
                document.getElementById("ms-panel").setAttribute("class", "col-6")
                document.getElementById("panel-1").setAttribute("class", "col-6")
                document.getElementById("panel-2").setAttribute("class", "col d-none")
                document.getElementById("open-button").classList.toggle("d-none")
                document.getElementById("close-button").classList.toggle("d-none")
            }
        </script>



        <div class="container">
            
            <!--Row containing cluster stats-->            
            <div class="row p-1">
                <div class = "col-4">
                    <h4 id="cluster-count">Number of clusters: </h4>
                </div>
                <div class="col-4">
                    <select class = "form-select" multiple id="cluster-selector">
                        <option>one</option>
                        <option>two</option>
                        <option>three</option>
                    </select>
                </div>
                <div class = "col-4">
                    <h4>Books in selected</h4>
                    <div id="cl-book-list" class="bookBox">
                        Select a cluster to see books

                    </div>
                </div>
            </div>

            <!-- Search row-->
            <div class="p-2 row">
                <div class = "col-6">
                    <input type="text" id="searched" class="rtl-input"/>
                    <button id="initiate-search", onclick="highlight('0')">Highlight</button>
                    <button id="remove-all", onclick="removeHiglight()">Remove all</button>
                </div>
                <div class="col-6 text-end">
                    <button id = "open-button", onClick="openPanel()" class="d-none">
                        Show Panel 2
                    </button>
                    <button id="close-button" onClick="closePanel()">
                        Hide Panel 2
                    </button>
                </div>
            </div>            

           

            <!--Row for viewing texts-->
            <div class="row select">
                
                <div class="col" id="ms-panel">
                    <!-- Top row of options -->
                    <div class="row">
                        <div class = "col-1">
                            <a data-bs-toggle="offcanvas" role="button" href="#offcanvasExample" aria-controls="offcanvasExample">
                                <i class="bi bi-list"></i>
                            </a>
                        </div>
                        <div class = "col-1">
                            <a href="@prev_ms@">
                                <i class = "bi bi-arrow-left-circle"></i>
                            </a>
                        </div>
                        <div class = "col-9">
                            <p>@ms_no@</p>
                        </div>
                        <div class = "col-1">
                            <a href="@next_ms@">
                                <i class = "bi bi-arrow-right-circle"></i>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Div for the text-->
                    <div class = "border scrollDiv" id="ms-container">
                        MS_TEXT
                    </div>
                </div>
                <!-- The js will populate this by looking-up the json of aligned text-->
                <div class="col" id="panel-1">
                    <!--Div containing options-->
                    <div class = "p-2">
                        <label for="pairs-dropdown-1">Panel 1: Select a book</label>
                        <select name="pairs-dropdown-1" value="" id="pairs-dropdown-1", onchange="getMilestone()">
                            <option value="">choose a book</option>
                            @option_list@
                        </select>
                    </div>
                    <!--Div containing text-->
                    <div id="text-container-1" class="border scrollDiv">
                        CONTAINER1
                    </div>
                </div>
                <!-- The js will populate this by looking-up the json of aligned text for container 2-->
                <div class="col" id="panel-2">
                    <!--Div containing options-->
                    <div class = "p-2">
                        <label for="pairs-dropdown-2">Panel 2: Select a book</label>
                        <select name="pairs-dropdown-2" value="" id="pairs-dropdown-2", onchange="getMilestone()">
                            <option value="">choose a book</option>
                            @option_list@
                        </select>
                    </div>
                    <!--Div containing text-->
                    <div id="text-container-2" class="border scrollDiv">
                        CONTAINER1
                    </div>
                </div>
            </div>
            
            <!-- Accordion containing original query text-->
            <div class="accordion p-1" id="accordion">
                <div class="accordion-item">
                    <h4 class="accordion-header" id="queryText">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#queryContent" aria-expanded="false" aria-controls="collapseTwo">
                        Cluster string
                    </button>
                    </h2>
                    <div id="queryContent" class="accordion-collapse collapse" aria-labelledby="queryText" data-bs-parent="#accordion">
                    <div class="accordion-body">
                        <div style="direction:rtl; font-family: Amiri;  font-size: 1.5em">
                            @query_string@
                        </div>
                        
                    </div>
                    </div>
                </div>
            </div>

            <!-- Off-canvas that will store the contents page of ms-->
            <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasLabel">Filename: @input_file_name@</h5>
                    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <h4>Select a milestone</h4>
                    @list_of_ms_links@
                </div>
            </div>

        </div>
        

    </body>

